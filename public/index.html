<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chat do Chat</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    #loginScreen, #chatScreen { padding: 20px; }
    #chatScreen { display: none; }
    #users { margin-bottom: 10px; }
    #messages { height: 300px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; }
    #messages div { margin-bottom: 8px; }
    .nickname { font-weight: bold; }
    .autoReplyCheckbox { margin-left: 8px; }
  </style>
</head>
<body>

<div id="loginScreen">
  <h2>Entre com seu apelido</h2>
  <input type="text" id="nicknameInput" placeholder="Seu apelido" />
  <button id="enterChatBtn">Entrar no Chat</button>
</div>

<div id="chatScreen">
  <h2>Chat do Chat</h2>
  <div id="users"></div>
  <div id="messages"></div>
  <input type="text" id="messageInput" placeholder="Digite sua mensagem..." />
  <button id="sendBtn">Enviar</button>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();

  const loginScreen = document.getElementById("loginScreen");
  const chatScreen = document.getElementById("chatScreen");
  const nicknameInput = document.getElementById("nicknameInput");
  const enterChatBtn = document.getElementById("enterChatBtn");
  const usersDiv = document.getElementById("users");
  const messagesDiv = document.getElementById("messages");
  const messageInput = document.getElementById("messageInput");
  const sendBtn = document.getElementById("sendBtn");

  let myNickname = null;

  enterChatBtn.onclick = () => {
    const nick = nicknameInput.value.trim();
    if (!nick) return alert("Digite um apelido!");
    myNickname = nick;
    socket.emit("set_nickname", nick);
    loginScreen.style.display = "none";
    chatScreen.style.display = "block";
  };

  socket.on("user_list", (nicknames) => {
    usersDiv.innerHTML = "<h3>Usu√°rios online</h3>";
    nicknames.forEach(nick => {
      const div = document.createElement("div");
      div.textContent = nick;
      if (nick === myNickname) {
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.className = "autoReplyCheckbox";
        checkbox.title = "Responder automaticamente";
        checkbox.onchange = (e) => {
          socket.emit("set_auto_reply", e.target.checked);
        };
        div.appendChild(checkbox);
      }
      usersDiv.appendChild(div);
    });
  });

  sendBtn.onclick = () => {
    const msg = messageInput.value.trim();
    if (!msg) return;
    socket.emit("send_message", msg);
    messageInput.value = "";
  };

  socket.on("receive_message", ({ nickname, message }) => {
    const div = document.createElement("div");
    div.innerHTML = `<span class="nickname">${nickname}:</span> ${message}`;
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  });
</script>

</body>
</html>
